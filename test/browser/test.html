<html>

  <head>
    <title>WebScad tests</title>
    
    <script type="text/javascript" src="../../extras/Three.js"></script>
    <script type="text/javascript" src="../../extras/webscad.js"></script>
    <script type="text/javascript">
    var renderer = scene = camera = currentGeometry = null;
    window.scad = new webscad.Scad();
    window.scadToThreeConverter = new webscad.ThreeRenderer();

    window.onload = function() {
            
            renderer = new THREE.CanvasRenderer();
            renderer.setSize( 500, 400 );
            document.getElementById('output-wrap').appendChild( renderer.domElement );

            scene = new THREE.Scene();

            camera = new THREE.PerspectiveCamera( 70, window.innerWidth / window.innerHeight, 1, 1000 );
            camera.position.y = 150;
            camera.position.z = 500;
            scene.add( camera );

            // Light

            var light = new THREE.PointLight( 0xFFFF00 );
            light.position.set( 10, 0, 10 );
            scene.add( light );

				    // Cube

				    var materials = [];

				    for ( var i = 0; i < 6; i ++ ) {

					    materials.push( new THREE.MeshBasicMaterial( { color: Math.random() * 0xffffff } ) );

				    }

    };
    
    function render(text) {
      if(currentGeometry !== null) {
        scene.remove(currentGeometry);
      }

      try {
        // Compile & Run
        console.log("Compiling..")
        var polyhedron = scad.evalCsg(text);

        // Render
        console.log("Rendering..")
        currentGeometry = new THREE.Mesh(
            scadToThreeConverter.render(polyhedron),
            new THREE.MeshFaceMaterial()
        );
        currentGeometry.position.y = 150;
        currentGeometry.rotation.y = 0.5;

	      scene.add( currentGeometry );

        renderer.render(scene, camera);
      } catch(e) {
        console.log(e);
      }
    };
    </script>
    
    <style>
    #input-wrap {
      float:left;
      width:48%;
    }
      #scad-input {
        width:98%;
        height:400px;
      }
    #output-wrap {
      float:left;
      width:48%;
    }
    </style>
    
  </head>

  <body>
    <div id='input-wrap'>
      <textarea id='scad-input'>cube(size=100,center=false)</textarea>
      <input type="button" onclick='render(document.getElementById("scad-input").value)' value='render' />
    </div>
    <div id='output-wrap'>
    
    </div>
  </body>

</html>
