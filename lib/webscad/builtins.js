// Generated by CoffeeScript 1.4.0
(function() {
  var ast, csg, csgOperationModule, cubeModule, cylinderModule, defineModule, differenceModule, intersectModule, rotateModule, sphereModule, translateModule, unimplementedModule, unionModule;

  csg = typeof CSG !== "undefined" && CSG !== null ? CSG : require('../csg_module').CSG;

  ast = require('./ast');

  defineModule = function(params, func) {
    func.params = params;
    return func;
  };

  unimplementedModule = function(name) {
    return defineModule([], function() {
      throw "'" + this.name + "' is not implemented.";
    });
  };

  cubeModule = defineModule(['size'], function(ctx, submodules) {
    var center, radius;
    radius = ctx.getVar('size');
    if (!(radius instanceof Array)) {
      radius = [radius, radius, radius];
    }
    center = ctx.getVar('center') ? [radius[0] / 2, radius[1] / 2, radius[2] / 2] : [0, 0, 0];
    return csg.cube({
      radius: radius,
      center: center
    });
  });

  sphereModule = defineModule(['r'], function(ctx, submodules) {
    var radius;
    radius = ctx.getVar('r');
    return csg.sphere({
      radius: radius,
      center: [0, 0, 0]
    });
  });

  cylinderModule = defineModule(['h', 'r1', 'r2', 'r'], function(ctx, submodules) {
    var height, radius;
    radius = ctx.getVar('r');
    height = ctx.getVar('h');
    return csg.cylinder({
      radius: radius,
      center: [0, 0, 0]
    });
  });

  csgOperationModule = function(csgName) {
    return defineModule([], function(ctx, submodules) {
      var result, submodule, _i, _len;
      for (_i = 0, _len = submodules.length; _i < _len; _i++) {
        submodule = submodules[_i];
        if (!(typeof result !== "undefined" && result !== null)) {
          result = submodule;
        } else {
          result = result[csgName](submodule);
        }
      }
      return result;
    });
  };

  unionModule = csgOperationModule('union');

  intersectModule = csgOperationModule('intersect');

  differenceModule = csgOperationModule('subtract');

  rotateModule = defineModule(['a', 'v'], function(ctx, submodules) {
    var angle, submodule, vectors, _i, _len, _results;
    angle = ctx.getVar('a');
    vectors = ctx.getVar('v');
    if (!(vectors != null) || vectors.length !== 3) {
      throw new Error("You need to provide a three-value vector to rotate. Got '" + vectors + "'.");
    }
    if (angle != null) {
      vectors = [vectors[0] * angle, vectors[1] * angle, vectors[2] * angle];
    }
    _results = [];
    for (_i = 0, _len = submodules.length; _i < _len; _i++) {
      submodule = submodules[_i];
      if (vectors[0] !== 0) {
        submodule = submodule.rotateX(vectors[0]);
      }
      if (vectors[1] !== 0) {
        submodule = submodule.rotateY(vectors[1]);
      }
      if (vectors[2] !== 0) {
        submodule = submodule.rotateZ(vectors[2]);
      }
      _results.push(submodule);
    }
    return _results;
  });

  translateModule = defineModule(['v'], function(ctx, submodules) {
    var submodule, vector, _i, _len, _results;
    vector = ctx.getVar('v');
    _results = [];
    for (_i = 0, _len = submodules.length; _i < _len; _i++) {
      submodule = submodules[_i];
      _results.push(submodule.translate(vector));
    }
    return _results;
  });

  exports.modules = {
    cube: cubeModule,
    cylinder: cylinderModule,
    sphere: sphereModule,
    polyhedron: unimplementedModule('polyhedron'),
    square: unimplementedModule('square'),
    circle: unimplementedModule('circle'),
    polygon: unimplementedModule('polygon'),
    union: unionModule,
    difference: differenceModule,
    intersection: intersectModule,
    render: unimplementedModule('render'),
    translate: translateModule,
    rotate: rotateModule
  };

  exports.functions = {};

}).call(this);
